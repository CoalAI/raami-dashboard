{% extends "dashboard/layout.html" %}
{% load static %}

{% block extra-css %}
<link rel="stylesheet" href="{% static 'vendors/select2/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'vendors/select2-bootstrap-theme/select2-bootstrap.min.css' %}">
{% endblock %}

{% block left-content %}
<div class="main-panel">
  <div class="content-wrapper">
    <div class="row">
      <div class="col-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Calculate Score</h4>
            <form method="POST" id="scoreForm">
              <div class="form-group">
                <label>County</label>
                <select class="js-example-basic-single w-100" id="county" name="county">
                  {% for county in counties %}
                    <option value="{{county}}">{{county}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group">
                <label>State</label>
                <select class="js-example-basic-single w-100" id="state" name="state">
                  <option value="">No State</option>
                  {% for state in states %}
                    <option value="{{state}}">{{state}}</option>
                  {% endfor %}
                </select>
              </div>
              <button type="submit" id="scoreForm_btn" class="btn btn-primary me-2">
                <span id="loader" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Submit
              </button>
              <span id="message_text">{{message}}</span>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block plugin-js %}
<script src="{% static 'vendors/typeahead.js/typeahead.bundle.min.js' %}"></script>
<script src="{% static 'vendors/select2/select2.min.js' %}"></script>
<script src="{% static 'vendors/bootstrap-datepicker/bootstrap-datepicker.min.js' %}"></script>
{% endblock %}

{% block custom-js %}
<script src="{% static 'js/file-upload.js' %}"></script>
<script src="{% static 'js/typeahead.js' %}"></script>
<script src="{% static 'js/select2.js' %}"></script>
<script>
  $('#scoreForm').submit(ajax_submit_param);
  $('#loader').hide();

  function ajax_submit_param(event) {
    console.log('ayayaya');
    event.preventDefault();
    $('#scoreForm_btn').prop("disabled", true);
    $('#loader').show();

    const county =  $("#county").val();
    const state =  $("#state").val()

    $.ajax('', {
      headers: {'X-CSRFToken': getCookie('csrftoken')},
      data: {
        'county': county,
        'state': state
      },
      type: 'post',
      success: function (result) {
        // success code execution here
        $('#message_text').html(result);
      },
      error: function (xhr, status, error) {
        $('#message_text').html(error);
      },
      complete: function (xhr, status) {
        // completion code here
        $('#scoreForm_btn').prop("disabled", false);
        $('#loader').hide();
      }
    });
  }
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
{% endblock %}
